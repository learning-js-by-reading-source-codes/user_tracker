!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).ZxmSpm=t()}(this,(function(){"use strict";function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var t={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var n,r,i,o,s,a,u,c="",l=0;for(e=t._utf8_encode(e);l<e.length;)o=(n=e.charCodeAt(l++))>>2,s=(3&n)<<4|(r=e.charCodeAt(l++))>>4,a=(15&r)<<2|(i=e.charCodeAt(l++))>>6,u=63&i,isNaN(r)?a=u=64:isNaN(i)&&(u=64),c=c+this._keyStr.charAt(o)+this._keyStr.charAt(s)+this._keyStr.charAt(a)+this._keyStr.charAt(u);return c},_utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t+=String.fromCharCode(r):r>127&&r<2048?(t+=String.fromCharCode(r>>6|192),t+=String.fromCharCode(63&r|128)):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(63&r|128))}return t}};return new(function(){function n(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.env="dev",this.baseUrl="https://p.abczzz.cn/spm/spm"}var r,i,o;return r=n,(i=[{key:"setEnv",value:function(e){this.env=e}},{key:"setUrl",value:function(e){this.baseUrl=e}},{key:"test",value:function(){console.log("test1 111")}},{key:"guid2",value:function(){for(var e=[],t="0123456789abcdef",n=0;n<36;n++)e[n]=t.substr(Math.floor(16*Math.random()),1);return e[14]="4",e[19]=t.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-",e.join("")}},{key:"getUUID",value:function(){var e="";return this.isBorwer()?e=localStorage.getItem("zxm_spm_uuid"):this.isWinXinXcx()?e=wx.getStorageSync("zxm_spm_uuid"):this.isAliPayXcx()&&(e=my.getStorageSync("zxm_spm_uuid")),e||(e=this.guid2(),this.isBorwer()?localStorage.setItem("zxm_spm_uuid",e):this.isWinXinXcx()?wx.setStorageSync("zxm_spm_uuid",e):this.isAliPayXcx()&&my.setStorageSync("zxm_spm_uuid",e)),e}},{key:"encodeParams",value:function(e,n,r){var i=Object.assign({spm:"",uuid:this.getUUID(),type:"spm",page:this.getHref(),log_time:(new Date).getTime(),log_data:JSON.stringify({})},{spm:n,type:e,log_data:JSON.stringify(r)}),o=t.encode(encodeURIComponent(JSON.stringify(i))).split("").reverse().join("");return"dev"===this.env&&console.log("打点数据",JSON.stringify(i,null,1)),o}},{key:"isWinXinXcx",value:function(){var e=!1;try{wx&&wx.request&&(e=!0)}catch(e){}return e}},{key:"isAliPayXcx",value:function(){var e=!1;try{my&&my.request&&(e=!0)}catch(e){}return e}},{key:"isBorwer",value:function(){var e=!1;return"undefined"!=typeof XMLHttpRequest&&"[object Function]"==Object.prototype.toString.call(XMLHttpRequest)&&(e=!0),e}},{key:"isNode",value:function(){var e=!1;return"undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process)&&(e=!0),e}},{key:"getHref",value:function(){var e="";if(this.isBorwer())e=window.location.href;else if(this.isWinXinXcx()){var t=getCurrentPages();e=t[t.length-1].route}else if(this.isAliPayXcx()){var n=getCurrentPages();e=n[n.length-1].route}else e="";return e}},{key:"sendSpmAliPay",value:function(e){var t=this.baseUrl;my.request({url:t,method:"POST",data:{p:e},header:{"content-type":"application/json;charset=UTF-8"}})}},{key:"sendSpmWeixin",value:function(e){var t=this.baseUrl;wx.request({url:t,method:"POST",data:{p:e},header:{"content-type":"application/json;charset=UTF-8"}})}},{key:"sendSpmBrower",value:function(e){if(new Blob([e]).size<=4096){var t=this.baseUrl+"?p="+e,n=document.createElement("img");n.style.display="none",n.src=t,document.body.appendChild(n),document.body.removeChild(n)}else{var r=new XMLHttpRequest;r.open("POST",this.baseUrl),r.setRequestHeader("Content-type","application/json"),r.send(JSON.stringify({p:e}))}}},{key:"sendSpm",value:function(e){var t=this;setTimeout((function(){t.isBorwer()?t.sendSpmBrower(e):t.isWinXinXcx()?t.sendSpmWeixin(e):t.isAliPayXcx()?t.sendSpmAliPay(e):console.log("未知环境")}),0)}},{key:"spm",value:function(e,t,n){if(e&&1!=e.split(".").lengtn){var r=this.encodeParams(-1!=["spm","log","err"].indexOf(n)?n:"spm",e,t);this.sendSpm(r)}}},{key:"spmErr",value:function(e,t){if(e&&1!=e.split(".").lengtn){var n=this.encodeParams("err",e,t);this.sendSpm(n)}}},{key:"spmLog",value:function(e,t){if(e&&1!=e.split(".").lengtn){var n=this.encodeParams("log",e,t);this.sendSpm(n)}}}])&&e(r.prototype,i),o&&e(r,o),Object.defineProperty(r,"prototype",{writable:!1}),n}())}));
